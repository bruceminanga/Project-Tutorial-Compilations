{% load crispy_forms_tags %}
<!DOCTYPE html>
<html>
<head>
    <title>Calculator Project Using forms.py</title>
    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-beta1/css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> -->
    <style>
        .card-button {
            width: 200px; /* Adjust as needed */
            float: right;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Understanding Coupon System</h1>
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-6">
                <div class="card shadow-lg p-3 mb-5 bg-white rounded">
                    <div class="card-body">
                        <h5 class="card-title text-center">Price Calculator</h5>
                        <form method="post" id="myform">
                            {% csrf_token %}
                            <!-- {{ form.as_p }} -->
                            {{form.academic_level | as_crispy_field}}
                            <label for="">Number of pages {{form.service_type}}
                                {{form.currency}}</label>
                            <label for="">
                                {{form.writer}}
                            </label>
                            {{form.number_of_pages_increment}}

                            <!-- buttons -->
                            <div class="field-name">
                                {{ form.writer_category.label }}
                            </div>
                            <input type="hidden" id="selected_choice" name="selected_choice">

                            {% for choice in form.writer_category.field.choices %}
                                <div class="card-button" onclick="selectChoice('{{ choice.0 }}')">
                                    <div>
                                        {{ choice.1 }}
                                    </div>
                                    <div>
                                        {% if choice.0 == 'standard' %}
                                            Standard Price Writers
                                        {% elif choice.0 == 'premium' %}
                                            High Rank Writer
                                        {% elif choice.0 == 'platinum' %}
                                            English
                                        {% endif %}
                                    </div>
                                </div>

                            {% endfor %}
                            
                            
                            <button type="submit" class="btn btn-primary btn-block">Calculate Price</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-lg p-3 mb-5 bg-white rounded">
                    <div class="card-body">
                        <h5 class="card-title text-center">Results</h5>
                        <p id="selectedOptions"></p>
                        <p id="totalPrice"></p>
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}
                    {{ form2.as_p }}
                
                    <button type="submit">Apply</button>
                </form>
            </div>
        </div>
    </div>

    <script>
      window.onload = function() {
    document.getElementById('myform').addEventListener('change', function() {
        var academicLevel = document.getElementsByName('academic_level')[0].value;
        var serviceType = document.getElementsByName('service_type')[0].value;
        var currency = document.getElementsByName('currency')[0].value;
        var numberOfPages = document.getElementsByName('number_of_pages_increment')[0].value;
        var writerCategory = "{{form.writer}}"; // Django variable
        document.getElementById('selectedOptions').innerText = 'The academic level is: ' + academicLevel + ', \n the service type is: ' + serviceType + ', \n The currency is: ' + currency + ', \n The number of pages is: ' + numberOfPages + ', \n The writer category is: ' + writerCategory; // Added writerCategory

        // Calculate the total price based on the selected options
        var totalPrice = calculatePrice(academicLevel, serviceType, currency, numberOfPages);
        document.getElementById('totalPrice').innerText = 'The total price is: ' + currency + ' ' + totalPrice;
    });
}

function calculatePrice(academicLevel, serviceType, currency, numberOfPages) {
    var basePrices = {'high_school': 10, 'undergraduate': 20, 'masters': 30, 'phd': 40};
    var serviceMultipliers = {'writing': 1, 'editing': 0.8, 'proofreading': 0.6};
    var currencyRates = {'USD': 1, 'EUR': 0.85, 'GBP': 0.75, 'KES': 110.15};
    var basePrice = basePrices[academicLevel];
    var serviceMultiplier = serviceMultipliers[serviceType];
    var currencyRate = currencyRates[currency];
    var price = basePrice * serviceMultiplier * currencyRate * numberOfPages;
    return price;
}


    </script>

    <script>function selectChoice(choice) {
        // Handle the user's selection.
        // For example, you might update a hidden form field with the selected choice.
        document.getElementById('selected_choice').value = choice;
    }</script>

    <!-- bootsrap script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>
